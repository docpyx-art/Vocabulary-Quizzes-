<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Math – Set 12</title>

<!-- MathJax (Computer Modern-like) -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(','\\)'], ['$', '$']],
      displayMath: [['\\[','\\]']]
    },
    options: {
      skipHtmlTags: ['script','noscript','style','textarea','pre','code']
    },
    chtml: {
      scale: 1.25   /* ← THIS line controls math size */
    }
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<style>
body { margin:0; font-family:Arial,sans-serif; background:#fff; }

.top-bar { padding:12px 20px; border-bottom:1px solid #ccc; font-weight:bold; }

/* Container: single column layout for Math test */
.container {
  display:flex;
  flex-direction:column;
  flex-grow:1;
  padding:20px;
  padding-bottom:150px; /* prevents bottom bar hiding options */
}

.passage { font-size:16px; line-height:1.6; white-space:pre-wrap; margin-bottom:20px; }
#stem { margin-bottom:6px; }

/* --- FIXED QBOX SIZE WITHOUT CHANGING OTHER STYLES --- */
.qbox {
  display:inline-block;
  align-self:flex-start;
  padding:4px 8px;
  width:auto;
  min-width:0;
  text-align:center;
  border:2px solid #000;
  border-radius:4px;
  font-weight:bold;
  font-size:16px;
  margin-bottom:10px;
}

.options label { display:block; margin:10px 0; padding:6px; cursor:pointer; border-radius:4px; }

/* ✅ Smaller question images (works because we REMOVE inline styles from question HTML) */
.qimg {
  max-width: 400px;   /* <-- make even smaller if you want: 160px / 140px */
  width: 100%;
  height: auto;
  display: block;
  margin: 12px auto;
}

.correct { background:#d4edda; }
.incorrect { background:#f8d7da; }

/* SPR input */
.spr-wrap { margin-top:10px; }
.spr-input {
  width:220px;
  max-width:100%;
  padding:8px 10px;
  font-size:16px;
  border:1px solid #333;
  border-radius:4px;
}
.spr-hint { margin-top:8px; font-size:14px; }

/* Bottom bar fixed at bottom */
.bottom-bar {
  display:flex;
  justify-content:flex-end;
  align-items:center;
  width:100%;
  background:#2f3e46;
  padding:10px 20px;
  position:fixed;
  bottom:0; left:0;
  box-sizing:border-box;
  color:#fff;
  gap:10px;
  z-index:20;
}

button { padding:9px 20px; border:none; cursor:pointer; border-radius:4px; color:#fff; font-weight:bold; }
.btn-answer { background:#3a5a98; }
.btn-nav { background:#556d98; }

.qpanelCollapsed {
  position:fixed;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  padding:6px 12px;
  cursor:pointer;
  background:#ff6f61;
  color:#fff;
  border-radius:4px;
  font-weight:bold;
  display:flex;
  align-items:center;
  z-index:21;
  font-size:13px;
}

.qpanelExpanded {
  display:none;
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  padding:10px;
  border-radius:6px;
  background:#1a1a1a;
  color:#fff;
  max-width:800px;
  overflow-y:auto;
  font-size:14px;
  text-align:center;
  z-index:20;
  max-height:300px;
}

.qgrid { display:grid; grid-template-columns:repeat(8,1fr); gap:6px; justify-content:center; margin-top:5px; }
.qnum-box { padding:8px; text-align:center; cursor:pointer; border-radius:4px; background:#333; color:#fff; font-weight:bold; }
.qnum-box.attempted { background:#ff6f61; color:#fff; }
.qnum-box:hover { opacity:0.8; }

/* MOBILE FRIENDLY */
@media (max-width: 768px) {
  .passage { font-size:15px; margin-bottom:15px; }
  #stem { font-size:15px; margin-bottom:10px; }
  #options label { font-size:14px; }
  .bottom-bar { flex-direction:column; gap:8px; }
  .btn-answer, .btn-nav { width:100%; text-align:center; }
  .qpanelCollapsed { font-size:12px; padding:5px 10px; }
  .qpanelExpanded { max-height:250px; font-size:13px; padding:8px; }
  .qgrid { grid-template-columns:repeat(4,1fr); gap:4px; }
  .qnum-box { padding:6px; font-size:12px; }

  /* slightly larger on mobile if needed */
  .qimg { max-width: 220px; }

  .container { padding-bottom:190px; }
}

@media only screen and (max-width: 600px) {
  .bottom-bar { flex-direction:column; align-items:stretch; gap:8px; }
  #qpanelCollapsed { left:10px; bottom:80px; transform:none; font-size:12px; }
  #qpanelExpanded { left:10px; bottom:120px; transform:none; max-width:calc(100% - 20px); font-size:13px; max-height:250px; }
}
</style>
</head>

<body>

<!-- Calculator button -->
<button id="openCalculator"
        style="position:absolute; top:10px; right:10px;
               padding:6px 12px; font-size:14px; border-radius:4px;
               border:1px solid #0077cc; background:#fff; color:#0077cc;
               cursor:pointer; z-index:30;">
  Calculator
</button>

<div class="top-bar">Math – Set 12</div>

<div class="container">
  <div id="qnumBox" class="qbox"></div>
  <div id="passage" class="passage"></div>
  <div id="stem"></div>
  <div id="options" class="options"></div>
</div>

<div class="bottom-bar">
  <button id="answerBtn" class="btn-answer">Show Correct Answer</button>
  <button id="prevBtn" class="btn-nav">Previous</button>
  <button id="nextBtn" class="btn-nav">Next</button>
  <button id="reviewBtn" class="btn-nav" style="background:#28a745;">Go to Review</button>
</div>

<div id="qpanel">
  <div id="qpanelCollapsed" class="qpanelCollapsed">
    <span id="currentQuestionLabel">Question</span>
    <span id="toggleArrow" style="margin-left:6px;">▲</span>
  </div>
  <div id="qpanelExpanded" class="qpanelExpanded">
    <div id="qgrid" class="qgrid"></div>
  </div>
</div>

<script>
document.getElementById('openCalculator').addEventListener('click', function() {
  window.open(
    'https://www.desmos.com/testing/collegeboard/graphing',
    'CalculatorWindow',
    'width=900,height=600,top=100,left=100,resizable=yes,scrollbars=yes'
  );
});

/* ✅ Important: typeset NEWLY inserted LaTeX every time */
function typesetMath() {
  if (window.MathJax && MathJax.typesetPromise) {
    const nodes = [
      document.getElementById('passage'),
      document.getElementById('options'),
      document.getElementById('stem')
    ];
    MathJax.typesetClear(nodes);
    MathJax.typesetPromise(nodes);
  }
}

// ===== SAT-Style Numeric Normalizer (for SPR equivalence) =====
function toNumber(value) {
  if (value == null) return null;

  let s = value.toString().trim();

  // Remove spaces
  s = s.replace(/\s+/g, "");

  // Normalize unicode minus (just in case)
  s = s.replace(/\u2212/g, "-");

  // Handle fraction like 27/50 or 16/17 (also allows decimals in numerator/denominator)
  const fractionMatch = s.match(/^(-?\d+(\.\d+)?)\/(-?\d+(\.\d+)?)$/);
  if (fractionMatch) {
    const numerator = parseFloat(fractionMatch[1]);
    const denominator = parseFloat(fractionMatch[3]);
    if (denominator !== 0) return numerator / denominator;
  }

  // Handle decimals (.54, 0.54, 5, -3.2 etc.)
  const num = parseFloat(s);
  return isNaN(num) ? null : num;
}

function numbersEqual(a, b, tolerance = 0.0001) {
  if (a == null || b == null) return false;
  return Math.abs(a - b) < tolerance;
}

function isCorrectAnswer(idx, givenRaw) {
  const q = questions[idx];
  const correct = q.answer;

  const givenStr = (givenRaw ?? "").toString().trim();
  if (!givenStr) return false;

  // MCQ: exact letter match
  if (q.options) {
    return givenStr === (correct ?? "").toString().trim();
  }

  // SPR: numeric equivalence
  const givenNum = toNumber(givenStr);

  if (Array.isArray(correct)) {
    return correct.some(c => numbersEqual(toNumber(c), givenNum));
  }
  return numbersEqual(toNumber(correct), givenNum);
}

// ==== QUESTIONS (Set 12: 363–378) ====
const questions = [

  {
    num: 363,
    passage: `
      <img src="363.png" class="qimg">

      The table gives the average time \\( t \\), in minutes, it takes Carly to travel a certain distance \\( d \\), in kilometers. Which equation could represent this linear relationship?
    `,
    stem: "",
    options: {
      A: "\\( t = 4d \\)",
      B: "\\( t = \\frac{1}{25} d \\)",
      C: "\\( t = 25d \\)",
      D: "\\( t = \\frac{1}{4} d \\)"
    },
    answer: "C",
    img: null
  },

  {
    num: 364,
    passage: `
      <img src="364.png" class="qimg">

      The graph of the function \\( f \\), where \\( y = f(x) \\), gives the total cost \\( y \\), in dollars, for a certain video game system and \\( x \\) games. What is the best interpretation of the slope of the graph in this context?
    `,
    stem: "",
    options: {
      A: "Each game costs \\$25.",
      B: "The video game system costs \\$100.",
      C: "The video game system costs \\$25.",
      D: "Each game costs \\$100."
    },
    answer: "A",
    img: null
  },

  {
    num: 365,
    passage: `
      <img src="365.png" style="width: 280px;">


      Points \\( M \\), \\( N \\), and \\( P \\) lie on the circle shown. On this circle, minor arc \\( MN \\) has a length of 39 centimeters and major arc \\( MPN \\) has a length of 195 centimeters. What is the circumference, in centimeters, of the circle shown?
    `,
    stem: "",
    options: {
      A: "39",
      B: "156",
      C: "195",
      D: "234"
    },
    answer: "D",
    img: null
  },

  {
    num: 366,
    passage: `
      In triangle \\( ABC \\), the measure of angle \\( A \\) is \\( 50^\\circ \\). If triangle \\( ABC \\) is isosceles, which of the following is NOT a possible measure of angle \\( B \\)?
    `,
    stem: "",
    options: {
      A: "50°",
      B: "65°",
      C: "80°",
      D: "100°"
    },
    answer: "D",
    img: null
  },

  {
    num: 367,
    passage: `
      An inspector begins a day of work with a large sample of shirts that need to be checked for defects. The inspector works at a constant rate throughout the morning. What type of model is best to model the number of shirts remaining to be checked for defects at any given time throughout the morning?
    `,
    stem: "",
    options: {
      A: "A linear model with a positive slope",
      B: "A linear model with a negative slope",
      C: "An exponential growth model",
      D: "An exponential decay model"
    },
    answer: "B",
    img: null
  },

  {
    num: 368,
    passage: `
     <img src="368.png" style="width: 250px;">

      The table above shows the number of international tourist arrivals, rounded to the nearest tenth of a million, to the top nine tourist destinations in both 2012 and 2013. Based on the information given in the table, how much greater, in millions, was the median number of international tourist arrivals to the top nine tourist destinations in 2013 than the median number in 2012, to the nearest tenth of a million?
    `,
    stem: "",
    options: null,
    answer: "1.3",
    img: null
  },

  {
    num: 369,
    passage: `
      If \\( x \\ne 0 \\), which of the following expressions is equivalent to

      \\[
        \\frac{\\sqrt{16x^4y^8}}{x^3}
      \\] ?
    `,
    stem: "",
    options: {
      A: "\\( 8x^2y^4 \\)",
      B: "\\( 4xy^4 \\)",
      C: "\\( 4x^{-2}y^2 \\)",
      D: "\\( 4x^{-1}y^4 \\)"
    },
    answer: "D",
    img: null
  },

  {
    num: 370,
    passage: `
      \\[
        g(x) = x^2 + 55
      \\]

      What is the minimum value of the given function?
    `,
    stem: "",
    options: {
      A: "0",
      B: "55",
      C: "110",
      D: "3,025"
    },
    answer: "B",
    img: null
  },

  {
    num: 371,
    passage: `
      Which expression is equivalent to

      \\[
        \\frac{4}{4x - 5} - \\frac{1}{x + 1} \\, ?
      \\]
    `,
    stem: "",
    options: {
      A: "\\( \\frac{1}{(x+1)(4x-5)} \\)",
      B: "\\( \\frac{3}{3x-6} \\)",
      C: "\\( -\\frac{1}{(x+1)(4x-5)} \\)",
      D: "\\( \\frac{9}{(x+1)(4x-5)} \\)"
    },
    answer: "D",
    img: null
  },

  {
    num: 372,
    passage: `
      \\[
        \\frac{x^2 - c}{x - b}
      \\]

      In the expression above, \\( b \\) and \\( c \\) are positive integers. If the expression is equivalent to \\( x + b \\) and \\( x \\ne b \\), which of the following could be the value of \\( c \\)?
    `,
    stem: "",
    options: {
      A: "4",
      B: "6",
      C: "8",
      D: "10"
    },
    answer: "A",
    img: null
  },

  {
    num: 373,
    passage: `
      According to data provided by the US Department of Energy, the average price per gallon of regular gasoline in the United States from September 1, 2014, to December 1, 2014, is modeled by the function \\( F \\) defined below, where \\( F(x) \\) is the average price per gallon \\( x \\) months after September 1.

      \\[
        F(x) = 2.74 - 0.19(x - 3)
      \\]

      The constant 2.74 in this function estimates which of the following?
    `,
    stem: "",
    options: {
      A: "The average monthly decrease in the price per gallon",
      B: "The difference in the average price per gallon from September 1, 2014, to December 1, 2014",
      C: "The average price per gallon on September 1, 2014",
      D: "The average price per gallon on December 1, 2014"
    },
    answer: "D",
    img: null
  },

  {
    num: 374,
    passage: `
      In the \\( xy \\)-plane, line \\( \\ell \\) passes through the point \\( (0, 0) \\) and is parallel to the line represented by the equation \\( y = 8x + 2 \\). If line \\( \\ell \\) also passes through the point \\( (3, d) \\), what is the value of \\( d \\)?
    `,
    stem: "",
    options: null,
    answer: "24",
    img: null
  },

  {
    num: 375,
    passage: `
      A line intersects two parallel lines, forming four acute angles and four obtuse angles. The measure of one of these eight angles is \\( (7x - 250)^\\circ \\). The sum of the measures of four of the eight angles is \\( k^\\circ \\). Which of the following could NOT be equivalent to \\( k \\), for all values of \\( x \\)?
    `,
    stem: "",
    options: {
      A: "\\( -14x + 1,540 \\)",
      B: "\\( 14x - 320 \\)",
      C: "\\( -28x + 1,720 \\)",
      D: "360"
    },
    answer: "A",
    img: null
  },

  {
    num: 376,
    passage: `
      <img src="376.png" style="width: 400px;">

      In the figure above, \\( RT = TU \\). What is the value of \\( x \\)?
    `,
    stem: "",
    options: {
      A: "72",
      B: "66",
      C: "64",
      D: "58"
    },
    answer: "C",
    img: null
  },

  {
    num: 377,
    passage: `
      The mean amount of time that the 20 employees of a construction company have worked for the company is 6.7 years. After one of the employees leaves the company, the mean amount of time that the remaining employees have worked for the company is reduced to 6.25 years. How many years did the employee who left the company work for the company?
    `,
    stem: "",
    options: {
      A: "0.45",
      B: "2.30",
      C: "9.00",
      D: "15.25"
    },
    answer: "D",
    img: null
  },

  {
    num: 378,
    passage: `
      The scatterplot shows the relationship between the length of time \\( y \\), in hours, a certain bird spent in flight and the number of days after January 11, \\( x \\).

      <img src="378.png" style="width: 350px; height: auto; margin: 12px 0;">


      What is the average rate of change, in hours per day, of the length of time the bird spent in flight on January 13 to the length of time the bird spent in flight on January 15?
    `,
    stem: "",
    options: null,
    answer: ["4.5", "9/2"],
    img: null
  }

];

// ==== EXISTING LOGIC ====
let currentQ = 0;
let answerShown = false;
let attempted = Array(questions.length).fill(false);
let userAnswers = Array(questions.length).fill(null);

function loadQuestion() {
  const q = questions[currentQ];

  // passage + optional image (legacy support)
  if (q.img) {
    document.getElementById('passage').innerHTML = `
      <img src="${q.img}" alt="Question Image" class="qimg">
      ${q.passage}
    `;
  } else {
    document.getElementById('passage').innerHTML = q.passage;
  }

  document.getElementById('qnumBox').innerText = `Q${q.num}`;
  document.getElementById('stem').innerText = q.stem || "";

  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';

  // MCQ
  if (q.options) {
    for (const [key, val] of Object.entries(q.options)) {
      const lbl = document.createElement('label');
      lbl.innerHTML = `<input type="radio" name="option" value="${key}"> ${key}. ${val}`;
      const input = lbl.querySelector('input');

      if (userAnswers[currentQ] === key) input.checked = true;

      input.addEventListener('change', () => {
        userAnswers[currentQ] = key;
        attempted[currentQ] = true;
        updateQpanel();
      });

      optionsDiv.appendChild(lbl);
    }
  } else {
    // SPR (student-produced response)
    const wrap = document.createElement('div');
    wrap.className = 'spr-wrap';
    wrap.innerHTML = `
      <input id="sprInput" class="spr-input" type="text" inputmode="decimal" />
      <div id="sprAnswerReveal" class="spr-hint"></div>
    `;
    optionsDiv.appendChild(wrap);

    const sprInput = document.getElementById('sprInput');
    if (userAnswers[currentQ] !== null) sprInput.value = userAnswers[currentQ];

    sprInput.addEventListener('input', () => {
      userAnswers[currentQ] = sprInput.value.trim();
      attempted[currentQ] = userAnswers[currentQ].length > 0;
      updateQpanel();
    });
  }

  answerShown = false;
  document.getElementById('answerBtn').innerText = 'Show Correct Answer';
  updateQpanel();

  // ✅ re-typeset LaTeX after injecting HTML
  typesetMath();
}

function toggleAnswer() {
  const q = questions[currentQ];
  const optionsDiv = document.getElementById('options');

  if (!answerShown) {
    // MCQ highlighting
    if (q.options) {
      for (const input of optionsDiv.querySelectorAll('input[type="radio"]')) {
        input.parentNode.classList.remove('correct','incorrect');
        if (input.value === q.answer) input.parentNode.classList.add('correct');
        else input.parentNode.classList.add('incorrect');
      }
    } else {
      // SPR reveal
      const reveal = document.getElementById('sprAnswerReveal');
      if (reveal) {
        const ans = Array.isArray(q.answer) ? q.answer.join(" or ") : q.answer;
        reveal.innerHTML = `<strong>Correct Answer:</strong> ${ans}`;
      }
    }

    document.getElementById('answerBtn').innerText = 'Hide Correct Answer';
    answerShown = true;
  } else {
    // remove highlights / hide reveal
    if (q.options) {
      for (const input of optionsDiv.querySelectorAll('input[type="radio"]')) {
        input.parentNode.classList.remove('correct','incorrect');
      }
    } else {
      const reveal = document.getElementById('sprAnswerReveal');
      if (reveal) reveal.innerHTML = '';
    }

    document.getElementById('answerBtn').innerText = 'Show Correct Answer';
    answerShown = false;
  }
}

document.getElementById('answerBtn').addEventListener('click', toggleAnswer);
document.getElementById('prevBtn').addEventListener('click', () => { if (currentQ > 0) currentQ--; loadQuestion(); });
document.getElementById('nextBtn').addEventListener('click', () => { if (currentQ < questions.length - 1) currentQ++; loadQuestion(); });

const collapsed = document.getElementById('qpanelCollapsed');
const expanded = document.getElementById('qpanelExpanded');
collapsed.addEventListener('click', () => {
  expanded.style.display = (expanded.style.display === 'block') ? 'none' : 'block';
});

function updateQpanel() {
  const grid = document.getElementById('qgrid');
  grid.innerHTML = '';
  questions.forEach((q, i) => {
    const b = document.createElement('div');
    b.innerText = q.num;
    b.className = 'qnum-box';
    b.classList.toggle('attempted', attempted[i]);
    b.addEventListener('click', () => { currentQ = i; loadQuestion(); expanded.style.display = 'none'; });
    grid.appendChild(b);
  });
  document.getElementById('currentQuestionLabel').innerText =
    `Question ${questions[currentQ].num} of ${questions.length}`;
}

loadQuestion();

// ==== REVIEW PAGE LOGIC ====
document.getElementById('reviewBtn').addEventListener('click', () => {
  const mainContent = document.querySelector('.container');
  const bottomBar = document.querySelector('.bottom-bar');
  const qpanel = document.getElementById('qpanel');

  mainContent.style.display = 'none';
  bottomBar.style.display = 'none';
  qpanel.style.display = 'none';

  let reviewDiv = document.getElementById('reviewPage');
  if (!reviewDiv) {
    reviewDiv = document.createElement('div');
    reviewDiv.id = 'reviewPage';
    reviewDiv.style.padding = '20px';
    reviewDiv.style.maxWidth = '600px';
    reviewDiv.style.margin = '0 auto';
    document.body.appendChild(reviewDiv);
  }
  reviewDiv.style.display = 'block';
  reviewDiv.innerHTML = '<h2>Review Questions</h2>';

  // ✅ Score: MCQ exact match; SPR numeric equivalence (fraction/decimal accepted)
  const correctCount = userAnswers.filter((ans, idx) => isCorrectAnswer(idx, ans)).length;
  const totalCount = questions.length;

  const scoreDiv = document.createElement('div');
  scoreDiv.style.fontWeight = 'bold';
  scoreDiv.style.marginBottom = '15px';
  scoreDiv.innerText = `Score: ${correctCount} / ${totalCount}`;
  reviewDiv.appendChild(scoreDiv);

  const ul = document.createElement('ul');
  ul.style.listStyle = 'none';
  ul.style.padding = '0';
  ul.style.display = 'flex';
  ul.style.flexWrap = 'wrap';
  ul.style.gap = '8px';

  questions.forEach((q, i) => {
    const li = document.createElement('li');
    li.innerText = q.num;
    li.style.padding = '8px 12px';
    li.style.border = '1px solid #333';
    li.style.borderRadius = '4px';
    li.style.cursor = 'pointer';

    const given = (userAnswers[i] ?? "").toString().trim();

    if (!given) li.style.background = '#555';
    else if (isCorrectAnswer(i, given)) li.style.background = '#28a745';
    else li.style.background = '#dc3545';

    li.style.color = '#fff';

    li.addEventListener('click', () => {
      currentQ = i;
      loadQuestion();
      reviewDiv.style.display = 'none';
      mainContent.style.display = 'flex';
      bottomBar.style.display = 'flex';
      qpanel.style.display = 'block';
    });

    ul.appendChild(li);
  });

  reviewDiv.appendChild(ul);

  let backBtn = document.getElementById('backToTestBtn');
  if (!backBtn) {
    backBtn = document.createElement('button');
    backBtn.id = 'backToTestBtn';
    backBtn.innerText = 'Back to Test';
    backBtn.style.background = '#556d98';
    backBtn.style.color = '#fff';
    backBtn.style.border = 'none';
    backBtn.style.padding = '10px 20px';
    backBtn.style.marginTop = '20px';
    backBtn.style.borderRadius = '4px';
    backBtn.style.cursor = 'pointer';
    reviewDiv.appendChild(backBtn);
  }
  backBtn.onclick = () => {
    reviewDiv.style.display = 'none';
    mainContent.style.display = 'flex';
    bottomBar.style.display = 'flex';
    qpanel.style.display = 'block';
  };

  // (Optional) typeset any math on review page (score only here, but safe)
  typesetMath();
});
</script>

</body>
</html>
